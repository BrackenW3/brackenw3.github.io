<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - BrackenW3</title>
    <link rel="stylesheet" href="assets/css/login.css">
    <!--
        This Login Page implementation demonstrates two authentication methods:
        1. GitHub Personal Access Token (PAT) Verification
        2. HashiCorp Vault Token Verification

        This is a client-side implementation suitable for GitHub Pages.
        Real security for static sites relies on what you do *after* authentication
        (e.g., fetching private content, triggering workflows).
    -->
</head>
<body>
    <div class="login-container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('github')">GitHub Token</button>
            <button class="tab-btn" onclick="switchTab('vault')">HashiCorp Vault</button>
        </div>

        <!-- GitHub Authentication Form -->
        <div id="github-form" class="login-form active">
            <form onsubmit="handleGitHubLogin(event)">
                <div class="form-group">
                    <label for="gh-token">Personal Access Token</label>
                    <input type="password" id="gh-token" class="form-control" placeholder="ghp_..." required>
                </div>
                <button type="submit" class="btn-primary">Authenticate</button>
            </form>
            <div id="gh-alert" class="alert"></div>
            <pre id="gh-result" class="result-box"></pre>
        </div>

        <!-- Vault Authentication Form -->
        <div id="vault-form" class="login-form">
            <form onsubmit="handleVaultLogin(event)">
                <div class="form-group">
                    <label for="vault-addr">Vault Address</label>
                    <input type="text" id="vault-addr" class="form-control" placeholder="https://vault.example.com" required>
                </div>
                <div class="form-group">
                    <label for="vault-token">Vault Token</label>
                    <input type="password" id="vault-token" class="form-control" placeholder="hvs. ..." required>
                </div>
                <button type="submit" class="btn-primary">Authenticate</button>
            </form>
            <div id="vault-alert" class="alert"></div>
            <pre id="vault-result" class="result-box"></pre>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script>
        // Tab switching logic
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));

            if (tab === 'github') {
                document.querySelector('.tab-btn:first-child').classList.add('active');
                document.getElementById('github-form').classList.add('active');
            } else {
                document.querySelector('.tab-btn:last-child').classList.add('active');
                document.getElementById('vault-form').classList.add('active');
            }

            // Clear alerts
            document.querySelectorAll('.alert').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.result-box').forEach(el => el.style.display = 'none');
        }

        // Handle GitHub Login
        async function handleGitHubLogin(e) {
            e.preventDefault();
            const token = document.getElementById('gh-token').value;
            const alertBox = document.getElementById('gh-alert');
            const resultBox = document.getElementById('gh-result');

            alertBox.style.display = 'none';
            resultBox.style.display = 'none';

            try {
                const user = await authenticateGitHub(token);

                alertBox.className = 'alert alert-success';
                alertBox.textContent = `Success! Logged in as ${user.login}`;
                alertBox.style.display = 'block';

                // Show raw data (optional)
                resultBox.textContent = JSON.stringify(user, null, 2);
                resultBox.style.display = 'block';

                // TODO: Redirect or perform next action here
                // window.location.href = '/dashboard.html';

            } catch (error) {
                alertBox.className = 'alert alert-error';
                alertBox.textContent = error.message;
                alertBox.style.display = 'block';
            }
        }

        // Handle Vault Login
        async function handleVaultLogin(e) {
            e.preventDefault();
            const addr = document.getElementById('vault-addr').value;
            const token = document.getElementById('vault-token').value;
            const alertBox = document.getElementById('vault-alert');
            const resultBox = document.getElementById('vault-result');

            alertBox.style.display = 'none';
            resultBox.style.display = 'none';

            try {
                const data = await authenticateVault(addr, token);

                alertBox.className = 'alert alert-success';
                alertBox.textContent = `Success! Token verified.`;
                alertBox.style.display = 'block';

                // Show raw data (optional)
                resultBox.textContent = JSON.stringify(data, null, 2);
                resultBox.style.display = 'block';

                // TODO: Store token or redirect
                // sessionStorage.setItem('vault_token', token);

            } catch (error) {
                alertBox.className = 'alert alert-error';
                alertBox.textContent = error.message;
                alertBox.style.display = 'block';
            }
        }
    </script>
</body>
</html>
